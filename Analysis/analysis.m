%% Load data
% clear all
% clc
% close all
run set_data.m
run set_parameters.m

%% Trilateration 
rho_t1_sat1 = Trilateration(rho_obsv_t1_sat1, ref_matrix, 1e-4, rho_njtr_t1_sat1)
rho_t2_sat1 = Trilateration(rho_obsv_t2_sat1, ref_matrix, 1e-4, rho_njtr_t2_sat1)
rho_t1_sat2 = Trilateration(rho_obsv_t1_sat2, ref_matrix, 1e-4, rho_njtr_t1_sat2)
rho_t2_sat2 = Trilateration(rho_obsv_t2_sat2, ref_matrix, 1e-4, rho_njtr_t2_sat2)

%% Frame Conversion 
gst_t1 = GST(T1, t1); 
gst_t2_sat1 = GST(T2, t2_sat1); 
gst_t2_sat2 = GST(T2, t2_sat2); 

ijk_t1_sat1 = eceftoijk(rho_njtr_t1_sat1, gst_t1)
ijk_t2_sat1 = eceftoijk(rho_njtr_t2_sat1, gst_t1)
ijk_t1_sat2 = eceftoijk(rho_njtr_t1_sat2, gst_t1)
ijk_t2_sat2 = eceftoijk(rho_njtr_t2_sat2, gst_t1)

%% Lambert Solver
dt1 = seconds(t_sat1(2) - t_sat1(1));
dt2 = seconds(t_sat2(2) - t_sat2(1));

[v01, v1] = Lambert(ijk_t1_sat1, ijk_t2_sat1, dt1, 1, mu_earth, 1e-5)
[v02, v2] = Lambert(ijk_t1_sat2, ijk_t2_sat2, dt2, 1, mu_earth, 1e-5)
%% PRN
mu = 3.986*10^5;
tle1 = ['1 29486U 06042A   19272.00430744 -.00000001  00000-0  00000+0 0  9995'; 
       '2 29486  54.9590 248.8813 0093935   0.5082  31.6022  2.00560148 95342'];
tle2 = ['1 27663U 03005A   19272.09385061 -.00000030  00000-0  00000+0 0  9998';
       '2 27663  56.2455 312.2850 0106625  32.1585 330.1378  2.00567379122108'];
tle3 = ['1 27663U 03005A   19272.09385061 -.00000030  00000-0  00000+0 0  9998';
       '2 27663  56.2455 312.2850 0106625  32.1585 330.1378  2.00567379122108'];
tle4 = ['1 24876U 97035A   19272.18807153  .00000003  00000-0  00000+0 0  9997';
       '2 24876  55.4568 194.4010 0036176  67.5612 292.8340  2.00563944162551'];
tle5 = ['1 38833U 12053A   19272.31629780 -.00000004  00000-0  00000+0 0  9997';
       '2 38833  53.7378 244.1349 0086285  33.5442 326.9658  2.00559943 51133'];
tle6 = ['1 25030U 97067A   19272.33803917  .00000001  00000-0  00000+0 0  9994';
       '2 25030  56.0213 256.2534 0190156 231.6008 293.5417  2.00516989160455'];
tle7 = ['1 26690U 01004A   19272.35974556  .00000032  00000-0  00000+0 0  9997';
       '2 26690  53.2943 123.9467 0001296 356.1546 182.7140  1.91595261136520'];
tle8 = ['1 39741U 14026A   19272.45032143 -.00000030  00000-0  00000+0 0  9993';
       '2 39741  55.9700  67.1394 0016102 289.8941  69.9389  2.00564685 39320'];
tle9 = ['1 20959U 90103A   19272.48391087 +.00000035 +00000-0 +00000-0 0  9997';
       '2 20959 054.4426 136.9451 0017876 042.7358 317.5074 01.88156272209715'];
tle10 = ['1 32384U 07062A   19272.48624791 -.00000087  00000-0  00000+0 0  9992';
        '2 32384  56.4834  11.0588 0009646 122.0956 203.3162  2.00562300 86374'];
tle11 = ['1 32384U 07062A   19272.48624791 -.00000087  00000-0  00000+0 0  9992';
        '2 32384  56.4834  11.0588 0009646 122.0956 203.3162  2.00562300 86374'];
tle12 = ['1 28474U 04045A   19272.50293218 -.00000038  00000-0  00000+0 0  9990';
        '2 28474  54.7934  63.5258 0194068 261.9012 100.0304  2.00578637109238'];
tle13 = ['1 22231U 92079A   19272.53710043 +.00000004 +00000-0 +00000-0 0  9995';
        '2 22231 055.1771 198.1532 0032550 313.3900 046.3442 01.89107504015768'];
tle14 = ['1 40534U 15013A   19272.55094475 -.00000032  00000-0  00000+0 0  9991';
        '2 40534  54.4286 305.6404 0039273   3.5376 356.5465  2.00563196 33065'];
tle15 = ['1 40534U 15013A   19272.55094569 -.00000032 +00000-0 +00000-0 0  9996';
        '2 40534 054.4286 305.6405 0039258 003.5533 356.5309 02.00563180032636'];
tle16 = ['1 35752U 09043A   19272.59462258  .00000032  00000-0  00000+0 0  9994';
        '2 35752  54.4690 125.6613 0057421  43.7292 316.6570  2.00551811 74149'];
tle17 = ['1 35752U 09043A   19272.59462258  .00000032  00000-0  00000+0 0  9994';
        '2 35752  54.4690 125.6613 0057421  43.7292 316.6570  2.00551811 74149'];
tle18 = ['1 35752U 09043A   19272.59462258  .00000032  00000-0  00000+0 0  9994';
        '2 35752  54.4690 125.6613 0057421  43.7292 316.6570  2.00551811 74149'];
tle19 = ['1 35752U 09043A   19272.59462258  .00000032  00000-0  00000+0 0  9994';
        '2 35752  54.4690 125.6613 0057421  43.7292 316.6570  2.00551811 74149'];
tle20 = ['1 35752U 09043A   19272.59462258  .00000032  00000-0  00000+0 0  9994';
        '2 35752  54.4690 125.6613 0057421  43.7292 316.6570  2.00551811 74149'];
tle21 = ['1 26605U 00071A   19272.69514253 +.00000007 +00000-0 +00000-0 0  9990';
        '2 26605 055.0312 191.7874 0109855 249.7786 332.1308 02.00554402138357'];
tle22 = ['1 26605U 00071A   19272.69514253  .00000007  00000-0  00000+0 0  9999';
        '2 26605  55.0312 191.7874 0109855 249.7786 332.1308  2.00554402138346'];
tle23 = ['1 28474U 04045A   19272.75033867 -.00000040 +00000-0 +00000-0 0  9993';
        '2 28474 054.7936 063.5158 0194091 261.9054 278.6796 02.00578618109248'];
tle24 = ['1 41019U 15062A   19272.76047173  .00000032  00000-0  00000+0 0  9999';
        '2 41019  55.2204 127.1099 0049663 205.3918 154.4583  2.00564610 28644'];
tle25 = ['1 26407U 00040A   19272.76359852 -.00000037 +00000-0 +00000-0 0  9990';
        '2 26407 056.1862 312.4812 0193416 276.6305 083.5227 02.00559992140769'];
tle26 = ['1 38833U 12053A   19272.81488285 -.00000003  00000-0  00000+0 0  9994';
        '2 38833  53.7377 244.1143 0086298  33.5504 326.9594  2.00559949 51143'];
tle27 = ['1 38833U 12053A   19272.81488285 -.00000003 +00000-0 +00000-0 0  9995';
        '2 38833 053.7377 244.1143 0086298 033.5504 326.9594 02.00559949050366'];
tle28 = ['1 28129U 03058A   19272.88447774  .00000024  00000-0  00000+0 0  9993';
        '2 28129  53.1966 122.8369 0071095 286.1149  73.1942  2.00560713115612'];
tle29 = ['1 40294U 14068A   19272.91473815  .00000031  00000-0  00000+0 0  9990';
        '2 40294  55.2208 127.2854 0023982  39.2856 320.9842  2.00560124 36006'];
tle30 = ['1 40294U 14068A   19272.91473815  .00000031  00000-0  00000+0 0  9990';
        '2 40294  55.2208 127.2854 0023982  39.2856 320.9842  2.00560124 36006'];
tle31 = ['1 29486U 06042A   19272.95201061 -.00000000  00000-0  00000+0 0  9996';
        '2 29486  54.9587 248.8433 0093968   0.5417 355.8484  2.00560077 95359']; 
[OE1] = TLE2OE(tle1, mu);
[OE2] = TLE2OE(tle2, mu);
[OE3] = TLE2OE(tle3, mu);
[OE4] = TLE2OE(tle4, mu);
[OE5] = TLE2OE(tle5, mu);
[OE6] = TLE2OE(tle6, mu);
[OE7] = TLE2OE(tle7, mu);
[OE8] = TLE2OE(tle8, mu);
[OE9] = TLE2OE(tle9, mu);
[OE10] = TLE2OE(tle10, mu);
[OE11] = TLE2OE(tle11, mu);
[OE12] = TLE2OE(tle12, mu);
[OE13] = TLE2OE(tle13, mu);
[OE14] = TLE2OE(tle14, mu);
[OE15] = TLE2OE(tle15, mu);
[OE16] = TLE2OE(tle16, mu);
[OE17] = TLE2OE(tle17, mu);
[OE18] = TLE2OE(tle18, mu);
[OE19] = TLE2OE(tle19, mu);
[OE20] = TLE2OE(tle20, mu);
[OE21] = TLE2OE(tle21, mu);
[OE22] = TLE2OE(tle22, mu);
[OE23] = TLE2OE(tle23, mu);
[OE24] = TLE2OE(tle24, mu);
[OE25] = TLE2OE(tle25, mu);
[OE26] = TLE2OE(tle26, mu);
[OE27] = TLE2OE(tle27, mu);
[OE28] = TLE2OE(tle28, mu);
[OE29] = TLE2OE(tle29, mu);
[OE30] = TLE2OE(tle30, mu);
[OE31] = TLE2OE(tle31, mu);

[states1] = OE2Cart (OE1, mu);
[states2] = OE2Cart (OE2, mu);
[states3] = OE2Cart (OE3, mu);
[states4] = OE2Cart (OE4, mu);
[states5] = OE2Cart (OE5, mu);
[states6] = OE2Cart (OE6, mu);
[states7] = OE2Cart (OE7, mu);
[states8] = OE2Cart (OE8, mu);
[states9] = OE2Cart (OE9, mu);
[states10] = OE2Cart (OE10, mu);
[states11] = OE2Cart (OE11, mu);
[states12] = OE2Cart (OE12, mu);
[states13] = OE2Cart (OE13, mu);
[states14] = OE2Cart (OE14, mu);
[states15] = OE2Cart (OE15, mu);
[states16] = OE2Cart (OE16, mu);
[states17] = OE2Cart (OE17, mu);
[states18] = OE2Cart (OE18, mu);
[states19] = OE2Cart (OE19, mu);
[states20] = OE2Cart (OE20, mu);
[states21] = OE2Cart (OE21, mu);
[states22] = OE2Cart (OE22, mu);
[states23] = OE2Cart (OE23, mu);
[states24] = OE2Cart (OE24, mu);
[states25] = OE2Cart (OE25, mu);
[states26] = OE2Cart (OE26, mu);
[states27] = OE2Cart (OE27, mu);
[states28] = OE2Cart (OE28, mu);
[states29] = OE2Cart (OE29, mu);
[states30] = OE2Cart (OE30, mu);
[states31] = OE2Cart (OE31, mu);
range = zeros(31, 1);
range(1) = norm(states1);
range(2) = norm(states2);
range(3) = norm(states3);
range(4) = norm(states4);
range(5) = norm(states5);
range(6) = norm(states6);
range(7) = norm(states7);
range(8) = norm(states8);
range(9) = norm(states9);
range(10) = norm(states10);
range(11) = norm(states11);
range(12) = norm(states12);
range(13) = norm(states13);
range(14) = norm(states14);
range(15) = norm(states15);
range(16) = norm(states16);
range(17) = norm(states17);
range(18) = norm(states18);
range(19) = norm(states19);
range(20) = norm(states20);
range(21) = norm(states21);
range(22) = norm(states22);
range(23) = norm(states23);
range(24) = norm(states24);
range(25) = norm(states25);
range(26) = norm(states26);
range(27) = norm(states27);
range(28) = norm(states28);
range(29) = norm(states29);
range(30) = norm(states30);
range(31) = norm(states31);
satg32 = (24885.268756+25027.333239+24905.66238)/3
satg10 = (24741.064469+24965.346244+24859.33414)/3

